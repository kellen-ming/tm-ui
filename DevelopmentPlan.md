# TM-UI 组件库开发计划

## 📋 项目背景

- **现状**：官网项目已运行 2 年，使用魔改的 Antd 组件
- **目标**：基于 shadcn/ui 或从零开始构建自有组件库
- **原则**：最小化对原官网项目的影响，渐进式迁移

---

## 🎯 阶段 0：前期准备（建议新增）⭐

> **目标**：做好技术选型和架构设计，避免后期返工

### 0.1 技术选型确认

- [ ] **组件开发方案**
  - 选项 A：基于 shadcn/ui（✅ 推荐，社区活跃，质量高）
  - 选项 B：从零开始（适合特殊需求）
  - 选项 C：混合方案（shadcn/ui + 自定义组件）
- [ ] **样式方案确认**

  - Tailwind CSS 4（已选择）✅
  - 配色系统与官网项目对齐
  - 暗色模式支持策略

- [ ] **Monorepo 方案选型**
  - Turborepo（推荐，Next.js 官方推荐）
  - pnpm workspace（轻量级）
  - Nx（功能强大但学习成本高）

### 0.2 组件清单梳理

- [ ] **盘点现有 Antd 魔改组件**
  - 列出所有魔改过的组件清单
  - 标注魔改的具体内容（样式/功能/交互）
  - 评估迁移优先级和难度
- [ ] **制定迁移优先级**
  - P0：基础组件（Button、Card、Input 等）
  - P1：布局组件（Layout、Grid、Section 等）
  - P2：复杂组件（Form、Table、Modal 等）
  - P3：业务组件（特定业务场景组件）

### 0.3 设计系统规范

- [ ] **制定设计规范**
  - 颜色系统（主色、辅助色、语义色）
  - 间距系统（4px、8px、16px 等）
  - 圆角系统（none、sm、md、lg 等）
  - 字体系统（大小、行高、字重）
  - 阴影系统（elevation 层级）
- [ ] **组件 API 设计规范**
  - Props 命名规范
  - 事件命名规范
  - 默认值约定

---

## 🚀 阶段一：组件展示系统 + 基础组件开发（1-2 周）

> **目标**：搭建可用的展示系统，完成基础组件开发

### 1.1 展示系统开发（当前已基本完成 ✅）

- [x] 组件基础信息展示（名称、描述）
- [x] 动态属性控制器（Select、Boolean、Text）
- [x] 主题切换（light/dark）
- [x] 代码预览功能
- [x] 预设变体快捷切换
- [ ] **改进建议**：
  - [ ] 添加组件搜索功能
  - [ ] 添加代码复制功能（一键复制）
  - [ ] 添加组件导入路径提示
  - [ ] 添加响应式预览（Mobile/Tablet/Desktop）

### 1.2 一期基础组件开发

- [ ] **Button 组件**（当前已完成 ✅）
  - 已支持：variant、size、disabled
  - 建议补充：loading、icon、block、shape
- [ ] **Card 组件**（当前已完成 ✅）
  - 已支持：variant、shadow、padding、hoverable
  - 建议补充：header、footer、cover、actions
- [ ] **Card Group 组件**（新增）
  - Grid 布局支持
  - 响应式列数
  - 间距控制
- [ ] **Section 组件**（新增）
  - 容器宽度控制（full/container/narrow）
  - 垂直间距（padding 控制）
  - 背景变体（default/accent/muted）

### 1.3 基础工具搭建

- [ ] **组件测试环境**
  - 单元测试（Vitest/Jest）
  - 可访问性测试（axe-core）
- [ ] **文档生成工具**
  - Props 自动提取
  - 类型文档生成

---

## 🎨 阶段二：完善展示系统 + 扩展组件库（2-3 周）

> **目标**：完善展示系统功能，扩充常用组件

### 2.1 展示系统功能增强

- [ ] **API 文档表格**
  - Props 说明表
  - 类型定义
  - 默认值
  - 是否必填
- [ ] **使用示例丰富**
  - 基础用法
  - 组合用法
  - 最佳实践
  - 常见问题
- [ ] **交互增强**
  - 实时编辑代码预览
  - 组件 Playground
  - 导出配置为 JSON

### 2.2 二期组件开发（P0/P1 优先级）

- [ ] **基础组件**
  - [ ] Input（文本输入）
  - [ ] Textarea（多行文本）
  - [ ] Select（下拉选择）
  - [ ] Checkbox（复选框）
  - [ ] Radio（单选框）
  - [ ] Switch（开关）
- [ ] **布局组件**
  - [ ] Container（容器）
  - [ ] Grid（网格）
  - [ ] Flex（弹性布局）
  - [ ] Divider（分割线）
  - [ ] Spacer（间距）
- [ ] **反馈组件**
  - [ ] Alert（警告提示）
  - [ ] Toast（轻提示）
  - [ ] Modal（对话框）
  - [ ] Drawer（抽屉）
- [ ] **导航组件**
  - [ ] Tabs（标签页）
  - [ ] Breadcrumb（面包屑）
  - [ ] Pagination（分页）
  - [ ] Link（链接）

### 2.3 质量保障

- [ ] **可访问性（A11y）**
  - 键盘导航支持
  - 屏幕阅读器支持
  - ARIA 属性完善
- [ ] **性能优化**
  - 组件懒加载
  - 样式按需加载
  - Tree-shaking 支持

---

## 🏗️ 阶段三：Monorepo 改造 + 渐进式迁移（3-4 周）

> **目标**：改造为 Monorepo 结构，开始在官网项目中使用新组件

### 3.1 Monorepo 架构搭建

- [ ] **选择并配置 Monorepo 方案**
  - [ ] 推荐方案：**Turborepo + pnpm workspace**
  - [ ] 配置根目录结构
  - [ ] 配置构建和开发脚本
- [ ] **项目结构设计**
  ```
  tm-monorepo/
  ├── apps/
  │   ├── official-web/        # 官网项目（原项目）
  │   └── showcase/            # 组件展示站（当前tm-ui项目）
  ├── packages/
  │   ├── ui/                  # 组件库核心包
  │   ├── utils/               # 工具函数
  │   ├── hooks/               # 通用Hooks
  │   ├── icons/               # 图标库（可选）
  │   └── config/              # 共享配置
  ├── package.json
  ├── turbo.json
  └── pnpm-workspace.yaml
  ```

### 3.2 组件库包发布配置

- [ ] **npm 包配置**
  - [ ] package.json 配置
  - [ ] 导出路径配置（exports 字段）
  - [ ] TypeScript 类型声明
  - [ ] 打包配置（tsup/rollup）
- [ ] **版本管理**
  - [ ] Changesets 集成（推荐）
  - [ ] 版本发布流程
  - [ ] CHANGELOG 自动生成

### 3.3 官网项目渐进式迁移

- [ ] **第一批迁移（低风险页面）**
  - [ ] 新建的页面使用新组件
  - [ ] 非核心页面改造
  - [ ] AB 测试验证
- [ ] **第二批迁移（逐步替换）**
  - [ ] 按页面/模块逐步替换
  - [ ] 保持新旧组件共存
  - [ ] 详细的迁移文档
- [ ] **第三批迁移（全面替换）**
  - [ ] 完成所有页面迁移
  - [ ] 移除 Antd 依赖
  - [ ] 性能对比和优化

### 3.4 开发体验优化

- [ ] **CLI 工具开发**
  - [ ] 快速创建组件模板
  - [ ] 自动生成 showcase 配置
  - [ ] 组件测试脚手架
- [ ] **文档站点**
  - [ ] 考虑接入 Storybook（可选）
  - [ ] 或独立的文档网站（VitePress/Docusaurus）
  - [ ] 在线演示和代码编辑

---

## 📊 关键决策点

### 决策 1：要不要用 Storybook？

**方案对比：**

| 方案          | 优点                          | 缺点                       | 建议                     |
| ------------- | ----------------------------- | -------------------------- | ------------------------ |
| Storybook     | 生态成熟、插件丰富、社区大    | 配置复杂、构建慢、学习成本 | ⭐ 如果团队大于 5 人推荐 |
| 自研 Showcase | 轻量级、定制化强、加载快      | 需要自己维护、功能较简单   | ⭐ 目前 2-3 人团队推荐   |
| 混合方案      | Showcase 开发，Storybook 文档 | 维护两套系统               | 不推荐                   |

**建议**：当前团队规模小，先用自研 Showcase，后期团队扩大再考虑 Storybook。

### 决策 2：Monorepo 方案选择

**推荐：Turborepo + pnpm workspace**

理由：

- ✅ Next.js 官方推荐
- ✅ 配置简单，学习成本低
- ✅ 构建速度快，缓存机制好
- ✅ 与现有 pnpm 体系无缝集成

### 决策 3：迁移策略

**推荐：渐进式迁移（共存方案）**

```typescript
// 支持新旧组件共存
import { Button as AntdButton } from 'antd';           // 旧组件
import { Button as TMButton } from '@tm/ui';           // 新组件

// 使用别名区分
<AntdButton>旧按钮</AntdButton>
<TMButton>新按钮</TMButton>
```

---

## ⚠️ 风险提示

### 风险 1：样式冲突

- **问题**：Antd 全局样式可能与 Tailwind 冲突
- **解决**：使用 CSS Module 或 CSS-in-JS 隔离

### 风险 2：迁移成本

- **问题**：全量替换工作量大
- **解决**：制定详细的迁移 checklist，逐步推进

### 风险 3：维护成本

- **问题**：自研组件需要长期维护
- **解决**：建立完善的测试体系，文档要详细

### 风险 4：团队协作

- **问题**：团队成员不熟悉新组件
- **解决**：内部分享会、详细文档、示例代码

---

## 📅 时间规划建议

| 阶段                      | 预估时间    | 里程碑                 |
| ------------------------- | ----------- | ---------------------- |
| 阶段 0：前期准备          | 1 周        | 完成技术选型和设计规范 |
| 阶段 1：展示系统+基础组件 | 1-2 周      | 4 个基础组件可用       |
| 阶段 2：完善+扩展         | 2-3 周      | 15+组件，展示系统完善  |
| 阶段 3：Monorepo+迁移     | 3-4 周      | 官网首个页面使用新组件 |
| **总计**                  | **7-10 周** | **组件库投入生产使用** |

---

## ✅ 验收标准

### 阶段一验收

- [ ] 展示系统可正常运行
- [ ] 4 个基础组件开发完成
- [ ] 每个组件有至少 3 个变体
- [ ] 代码预览功能正常

### 阶段二验收

- [ ] 15+组件开发完成
- [ ] 展示系统功能完善（API 文档、示例等）
- [ ] 通过可访问性测试
- [ ] 响应式适配完成

### 阶段三验收

- [ ] Monorepo 结构搭建完成
- [ ] 组件库可独立 npm 包发布
- [ ] 官网至少 1 个页面使用新组件
- [ ] 性能指标不低于原有方案

---

## 🎓 参考资源

- [shadcn/ui 官方文档](https://ui.shadcn.com/)
- [Turborepo 官方文档](https://turbo.build/)
- [Tailwind CSS 最佳实践](https://tailwindcss.com/docs)
- [React 组件设计最佳实践](https://react.dev/learn)
- [WAI-ARIA 可访问性指南](https://www.w3.org/WAI/ARIA/apg/)

---

## 💡 补充建议

1. **建立组件设计评审机制**：每个新组件开发前，团队评审 API 设计
2. **每周进度同步**：避免闭门造车，及时发现问题
3. **建立组件使用反馈渠道**：收集使用者意见，持续优化
4. **性能监控**：对比新旧组件的性能指标
5. **回滚方案**：保留快速回滚到 Antd 的能力
