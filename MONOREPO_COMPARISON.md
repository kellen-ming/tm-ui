# Monorepo æ–¹æ¡ˆå¯¹æ¯”ï¼šNx vs Turborepo vs pnpm workspace

## ðŸ“Š å¿«é€Ÿå¯¹æ¯”è¡¨

| ç‰¹æ€§ | Nx | Turborepo | pnpm workspace |
|------|----|-----------| --------------|
| **å­¦ä¹ æˆæœ¬** | â­â­â­ è¾ƒé«˜ | â­â­ ä¸­ç­‰ | â­ å¾ˆä½Ž |
| **é…ç½®å¤æ‚åº¦** | â­â­â­ å¤æ‚ | â­â­ é€‚ä¸­ | â­ ç®€å• |
| **åŠŸèƒ½ä¸°å¯Œåº¦** | â­â­â­â­â­ æžå¼º | â­â­â­ ä¸­ç­‰ | â­â­ åŸºç¡€ |
| **æž„å»ºé€Ÿåº¦** | â­â­â­â­ å¿« | â­â­â­â­â­ æžå¿« | â­â­â­ ä¸€èˆ¬ |
| **ç¼“å­˜èƒ½åŠ›** | â­â­â­â­â­ å¼ºå¤§ | â­â­â­â­ å¼º | âŒ æ—  |
| **ç”Ÿæ€ç³»ç»Ÿ** | â­â­â­â­â­ ä¸°å¯Œ | â­â­â­ å¢žé•¿ä¸­ | â­â­â­â­ ä¾èµ– npm ç”Ÿæ€ |
| **é€‚ç”¨è§„æ¨¡** | å¤§åž‹ | ä¸­å¤§åž‹ | å°ä¸­åž‹ |
| **æŽ¨èæŒ‡æ•°** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­ |

---

## 1ï¸âƒ£ Nx - å…¨åŠŸèƒ½ä¼ä¸šçº§æ–¹æ¡ˆ

### âœ… ä¼˜ç‚¹

**ðŸš€ åŠŸèƒ½æœ€å¼ºå¤§**
```bash
# å¯è§†åŒ–ä¾èµ–å›¾
npx nx graph

# åªæž„å»ºå—å½±å“çš„é¡¹ç›®
npx nx affected:build

# æ™ºèƒ½æµ‹è¯•ï¼ˆåªæµ‹è¯•å—å½±å“çš„ä»£ç ï¼‰
npx nx affected:test
```

**ðŸŽ¨ å†…ç½®ä»£ç ç”Ÿæˆå™¨**
```bash
# ä¸€é”®åˆ›å»º Next.js åº”ç”¨
npx nx g @nx/next:app my-app

# ä¸€é”®åˆ›å»º React ç»„ä»¶åº“
npx nx g @nx/react:lib ui-components

# è‡ªå®šä¹‰ç”Ÿæˆå™¨
npx nx g @nx/plugin:generator my-generator
```

**ðŸ“¦ æ’ä»¶ç”Ÿæ€ä¸°å¯Œ**
- Reactã€Next.jsã€Angularã€Vue ç­‰å‰ç«¯æ¡†æž¶
- Node.jsã€Nest.js ç­‰åŽç«¯æ¡†æž¶
- Storybookã€Jestã€Cypress ç­‰å·¥å…·é›†æˆ
- äº‘ç¼“å­˜æ”¯æŒï¼ˆNx Cloudï¼‰

**ðŸŽ¯ é€‚åˆåœºæ™¯**
- å¤§åž‹ä¼ä¸šçº§é¡¹ç›®ï¼ˆ10+ ä¸ªå­é¡¹ç›®ï¼‰
- éœ€è¦ä¸¥æ ¼çš„ä»£ç è§„èŒƒå’Œæž¶æž„çº¦æŸ
- å›¢é˜Ÿè§„æ¨¡è¾ƒå¤§ï¼ˆ5+ å¼€å‘è€…ï¼‰
- éœ€è¦ CI/CD ä¼˜åŒ–ï¼ˆåªæž„å»º/æµ‹è¯•å˜æ›´éƒ¨åˆ†ï¼‰

### âŒ ç¼ºç‚¹

- **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼šæ¦‚å¿µå¤šï¼ˆworkspaceã€projectã€targetã€executor ç­‰ï¼‰
- **é…ç½®å¤æ‚**ï¼š`nx.json`ã€`workspace.json`ã€`project.json` å¤šä¸ªé…ç½®æ–‡ä»¶
- **è¿ç§»æˆæœ¬é«˜**ï¼šçŽ°æœ‰é¡¹ç›®è¿ç§»éœ€è¦å¤§é‡æ”¹é€ 
- **è¿‡åº¦å·¥ç¨‹åŒ–**ï¼šå¯¹å°é¡¹ç›®æ¥è¯´å¤ªé‡äº†

### ðŸ“¦ å®‰è£…ä½¿ç”¨

```bash
# åˆ›å»ºæ–°çš„ Nx workspace
npx create-nx-workspace@latest my-workspace

# ç›®å½•ç»“æž„
my-workspace/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js åº”ç”¨
â”‚   â””â”€â”€ api/              # Node.js åº”ç”¨
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ ui/               # UI ç»„ä»¶åº“
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”œâ”€â”€ nx.json               # Nx é…ç½®
â”œâ”€â”€ workspace.json        # å·¥ä½œåŒºé…ç½®
â””â”€â”€ package.json
```

---

## 2ï¸âƒ£ Turborepo - ç®€å•é«˜æ•ˆçš„çŽ°ä»£æ–¹æ¡ˆï¼ˆæŽ¨è â­ï¼‰

### âœ… ä¼˜ç‚¹

**âš¡ æž„å»ºé€Ÿåº¦æžå¿«**
- æ™ºèƒ½ä»»åŠ¡è°ƒåº¦
- å¹¶è¡Œæ‰§è¡Œ
- å¢žé‡æž„å»º
- è¿œç¨‹ç¼“å­˜ï¼ˆVercel æ”¯æŒï¼‰

**ðŸŽ¯ é…ç½®ç®€å•**
åªéœ€ä¸€ä¸ª `turbo.json` é…ç½®æ–‡ä»¶ï¼š

```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "dist/**"]
    },
    "dev": {
      "cache": false
    }
  }
}
```

**ðŸ”¥ Next.js å®˜æ–¹æŽ¨è**
- Vercel å®˜æ–¹å›¢é˜Ÿç»´æŠ¤
- ä¸Ž Next.js æ— ç¼é›†æˆ
- ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å‹å¥½

**ðŸŽ¯ é€‚åˆåœºæ™¯**
- ä¸­å¤§åž‹é¡¹ç›®ï¼ˆ3-10 ä¸ªå­é¡¹ç›®ï¼‰
- Next.js ä¸ºä¸»çš„æŠ€æœ¯æ ˆ
- è¿½æ±‚ç®€å•é«˜æ•ˆ
- éœ€è¦å¿«é€Ÿä¸Šæ‰‹

### âŒ ç¼ºç‚¹

- åŠŸèƒ½ç›¸å¯¹ Nx è¾ƒå°‘ï¼ˆæ²¡æœ‰ä»£ç ç”Ÿæˆå™¨ï¼‰
- ä¾èµ–å¯è§†åŒ–ä¸å¦‚ Nx
- æ’ä»¶ç”Ÿæ€è¿˜åœ¨å‘å±•ä¸­

### ðŸ“¦ å®‰è£…ä½¿ç”¨

```bash
# åˆ›å»ºæ–°çš„ Turborepo
npx create-turbo@latest

# ç›®å½•ç»“æž„
my-turborepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js åº”ç”¨
â”‚   â””â”€â”€ docs/             # æ–‡æ¡£ç«™ç‚¹
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/               # UI ç»„ä»¶åº“
â”‚   â”œâ”€â”€ config/           # å…±äº«é…ç½®
â”‚   â””â”€â”€ tsconfig/         # TypeScript é…ç½®
â”œâ”€â”€ turbo.json            # Turborepo é…ç½®ï¼ˆåªéœ€è¿™ä¸€ä¸ªï¼ï¼‰
â”œâ”€â”€ package.json
â””â”€â”€ pnpm-workspace.yaml
```

**è¿è¡Œå‘½ä»¤**
```bash
# æž„å»ºæ‰€æœ‰é¡¹ç›®
pnpm turbo build

# å¼€å‘æ‰€æœ‰é¡¹ç›®
pnpm turbo dev

# å¹¶è¡Œè¿è¡Œå¤šä¸ªå‘½ä»¤
pnpm turbo lint test build
```

---

## 3ï¸âƒ£ pnpm workspace - è½»é‡çº§åŸºç¡€æ–¹æ¡ˆ

### âœ… ä¼˜ç‚¹

**ðŸŽ¯ æžç®€é…ç½®**
åªéœ€ä¸€ä¸ª `pnpm-workspace.yaml`ï¼š

```yaml
packages:
  - 'apps/*'
  - 'packages/*'
```

**âš¡ ç£ç›˜ç©ºé—´æ•ˆçŽ‡é«˜**
- ç¡¬é“¾æŽ¥æœºåˆ¶ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´
- ä¾èµ–æå‡ç­–ç•¥åˆç†
- å¹½çµä¾èµ–é—®é¢˜å°‘

**ðŸ“¦ å­¦ä¹ æˆæœ¬ä½Ž**
- åŸºæœ¬å°±æ˜¯ npm/yarn workspace çš„å¢žå¼ºç‰ˆ
- å‘½ä»¤ç®€å•ç›´è§‚
- é€‚åˆæ–°æ‰‹å…¥é—¨

**ðŸŽ¯ é€‚åˆåœºæ™¯**
- å°åž‹é¡¹ç›®ï¼ˆ2-3 ä¸ªå­é¡¹ç›®ï¼‰
- ç®€å•çš„åŒ…ç®¡ç†éœ€æ±‚
- ä¸éœ€è¦å¤æ‚çš„æž„å»ºä¼˜åŒ–
- è¿½æ±‚æžç®€ä¸»ä¹‰

### âŒ ç¼ºç‚¹

- **æ— æž„å»ºç¼“å­˜**ï¼šæ¯æ¬¡éƒ½è¦é‡æ–°æž„å»º
- **æ— å¹¶è¡Œä¼˜åŒ–**ï¼šæž„å»ºé€Ÿåº¦ä¸€èˆ¬
- **æ— ä¾èµ–åˆ†æž**ï¼šä¸çŸ¥é“å“ªäº›é¡¹ç›®å—å½±å“
- **åŠŸèƒ½åŸºç¡€**ï¼šåªè´Ÿè´£åŒ…ç®¡ç†ï¼Œå…¶ä»–é è‡ªå·±

### ðŸ“¦ å®‰è£…ä½¿ç”¨

```bash
# 1. åˆ›å»º pnpm-workspace.yaml
echo "packages:
  - 'apps/*'
  - 'packages/*'" > pnpm-workspace.yaml

# 2. ç›®å½•ç»“æž„
my-workspace/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ package.json

# 3. è¿è¡Œå‘½ä»¤
pnpm install                          # å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm --filter web dev                 # è¿è¡Œ web é¡¹ç›®
pnpm --filter ui build                # æž„å»º ui åŒ…
pnpm -r build                         # é€’å½’æž„å»ºæ‰€æœ‰é¡¹ç›®
```

---

## ðŸŽ¯ å¦‚ä½•é€‰æ‹©ï¼Ÿ

### å†³ç­–æ ‘

```
ä½ çš„é¡¹ç›®æœ‰å¤šå°‘ä¸ªå­é¡¹ç›®ï¼Ÿ
â”‚
â”œâ”€ 2-3 ä¸ªï¼ˆå°åž‹ï¼‰
â”‚  â””â”€ é€‰æ‹©ï¼špnpm workspace âœ…
â”‚     ç†ç”±ï¼šå¤Ÿç”¨ï¼Œç®€å•
â”‚
â”œâ”€ 3-8 ä¸ªï¼ˆä¸­åž‹ï¼‰
â”‚  â””â”€ é€‰æ‹©ï¼šTurborepo â­â­â­â­â­
â”‚     ç†ç”±ï¼šç®€å• + é«˜æ•ˆ + Next.js äº²å’Œ
â”‚
â””â”€ 8+ ä¸ªï¼ˆå¤§åž‹ï¼‰
   â””â”€ é€‰æ‹©ï¼šNx â­â­â­â­
      ç†ç”±ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆä¼ä¸šçº§
```

### æŒ‰å›¢é˜Ÿè§„æ¨¡é€‰æ‹©

| å›¢é˜Ÿè§„æ¨¡ | æŽ¨èæ–¹æ¡ˆ | ç†ç”± |
|---------|---------|------|
| 1-2 äºº | pnpm workspace | å­¦ä¹ æˆæœ¬ä½Žï¼Œå¤Ÿç”¨ |
| 3-5 äºº | Turborepo | å¹³è¡¡ç®€å•å’Œæ€§èƒ½ |
| 5-10 äºº | Turborepo / Nx | çœ‹é¡¹ç›®å¤æ‚åº¦ |
| 10+ äºº | Nx | éœ€è¦ä¸¥æ ¼æž¶æž„çº¦æŸ |

### æŒ‰æŠ€æœ¯æ ˆé€‰æ‹©

| æŠ€æœ¯æ ˆ | æŽ¨èæ–¹æ¡ˆ |
|--------|---------|
| Next.js ä¸ºä¸» | Turborepo â­â­â­â­â­ |
| React å…¨å®¶æ¡¶ | Nx / Turborepo |
| Angular | Nxï¼ˆå®˜æ–¹æ”¯æŒï¼‰ |
| æ··åˆæŠ€æœ¯æ ˆ | Nx |
| çº¯ Node.js | Turborepo / pnpm |

---

## ðŸ’¡ é’ˆå¯¹ä½ çš„é¡¹ç›®ï¼ˆTM å®˜ç½‘ï¼‰çš„å»ºè®®

### ä½ çš„æƒ…å†µåˆ†æž

- **å›¢é˜Ÿè§„æ¨¡**ï¼š2-3 äººï¼ˆæŽ¨æµ‹ï¼‰
- **é¡¹ç›®æ•°é‡**ï¼šå®˜ç½‘ + ç»„ä»¶åº“ï¼ˆ2 ä¸ªä¸»é¡¹ç›®ï¼‰
- **æŠ€æœ¯æ ˆ**ï¼šNext.js + React
- **çŽ°çŠ¶**ï¼šå·²æœ‰æˆç†Ÿé¡¹ç›®ï¼Œéœ€è¦è¿ç§»

### âœ… æŽ¨èæ–¹æ¡ˆï¼š**Turborepo + pnpm workspace**

**ç†ç”±ï¼š**

1. **å­¦ä¹ æˆæœ¬ä½Ž**
   - é…ç½®ç®€å•ï¼Œä¸€ä¸ª `turbo.json` æžå®š
   - æ–‡æ¡£å‹å¥½ï¼Œç¤¾åŒºæ´»è·ƒ
   - å›¢é˜Ÿå¯ä»¥å¿«é€Ÿä¸Šæ‰‹

2. **æ€§èƒ½ä¼˜ç§€**
   - æž„å»ºé€Ÿåº¦å¿«ï¼ˆç¼“å­˜æœºåˆ¶ï¼‰
   - å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
   - æ”¯æŒå¢žé‡æž„å»º

3. **Next.js äº²å’Œ**
   - Vercel å®˜æ–¹å›¢é˜Ÿç»´æŠ¤
   - ä¸Ž Next.js æ— ç¼é›†æˆ
   - æœªæ¥å‡çº§æ— å¿§

4. **åˆšå¥½æ»¡è¶³éœ€æ±‚**
   - 2 ä¸ªä¸»é¡¹ç›® + è‹¥å¹²å…±äº«åŒ…
   - ä¸éœ€è¦ Nx é‚£ä¹ˆé‡çš„åŠŸèƒ½
   - æ¯”çº¯ pnpm workspace æ›´é«˜æ•ˆ

### ðŸ“¦ æŽ¨èçš„ç›®å½•ç»“æž„

```bash
tm-monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ official-web/          # å®˜ç½‘é¡¹ç›®ï¼ˆNext.js 14+ï¼‰
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ showcase/              # ç»„ä»¶å±•ç¤ºç«™ï¼ˆå½“å‰ tm-uiï¼‰
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/                    # ç»„ä»¶åº“æ ¸å¿ƒåŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ button/
â”‚   â”‚   â”‚   â”œâ”€â”€ card/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ package.json       # "@tm/ui": "workspace:*"
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ package.json       # "@tm/utils": "workspace:*"
â”‚   â”œâ”€â”€ hooks/                 # é€šç”¨ Hooks
â”‚   â””â”€â”€ config/                # å…±äº«é…ç½®
â”‚       â”œâ”€â”€ eslint-config/
â”‚       â”œâ”€â”€ tailwind-config/
â”‚       â””â”€â”€ typescript-config/
â”œâ”€â”€ turbo.json                 # Turborepo é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml        # pnpm workspace é…ç½®
â”œâ”€â”€ package.json               # æ ¹ package.json
â””â”€â”€ README.md
```

### ðŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£… Turborepo
pnpm add -Dw turbo

# 2. åˆ›å»º turbo.json
cat > turbo.json << 'EOF'
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "dependsOn": ["^lint"]
    }
  }
}
EOF

# 3. åˆ›å»º pnpm-workspace.yaml
cat > pnpm-workspace.yaml << 'EOF'
packages:
  - 'apps/*'
  - 'packages/*'
EOF

# 4. åœ¨ package.json ä¸­æ·»åŠ è„šæœ¬
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "lint": "turbo lint"
  }
}

# 5. è¿è¡Œ
pnpm dev           # åŒæ—¶å¯åŠ¨æ‰€æœ‰é¡¹ç›®çš„å¼€å‘æœåŠ¡å™¨
pnpm build         # æž„å»ºæ‰€æœ‰é¡¹ç›®
```

---

## ðŸ”— å‚è€ƒèµ„æº

- **Nx å®˜ç½‘**: https://nx.dev/
- **Turborepo å®˜ç½‘**: https://turbo.build/
- **pnpm workspace**: https://pnpm.io/workspaces
- **Monorepo å·¥å…·å¯¹æ¯”**: https://monorepo.tools/

---

## ðŸŽ“ æ€»ç»“

| å¦‚æžœä½ ... | é€‰æ‹©... |
|----------|---------|
| æƒ³è¦æœ€å¼ºå¤§çš„åŠŸèƒ½ | Nx |
| æƒ³è¦ç®€å•é«˜æ•ˆçš„æ–¹æ¡ˆ | Turborepo â­ |
| æƒ³è¦æžç®€çš„é…ç½® | pnpm workspace |
| ä¸ç¡®å®šé€‰å“ªä¸ª | **Turborepoï¼ˆæŽ¨èï¼‰** |

